/*global require, describe:true, it:true */

'use strict';

var _require = require('root-require');
var expect = require('chai').expect;
var flat = require('flat');
var Immutable = require('immutable');

describe('configs/services/theme', function () {
    var master = _require('configs/services/theme/master');
    master = Immutable.fromJS(master).get(0);
    master = flat(master.toJS());

    var deltas = _require('configs/services/theme/');
    deltas = Immutable.fromJS(deltas);

    var regexps = [
        /^settings.*?$/m
    ];

    deltas.forEach(function (delta) {
        it (delta.get('settings'), function () {
            var _delta = flat(delta.toJS());

            Object.keys(_delta).forEach(function(key) {
                var pattern;

                regexps.forEach(function (regexp) {
                    if (regexp.test(key)) {
                        // console.log('[REGEXP]', key, _delta[key]);
                        pattern = new RegExp(regexp);
                        return;
                    }
                });

                // console.log(key, master[key], _delta[key]);
                if (pattern) {
                    // RegExp Key Matching
                    // e.g.
                    //      MASTER
                    //      [
                    //          'settings.0'
                    //      ]
                    //
                    //      DELTA
                    //      [
                    //          'settings.0'
                    //          'settings.1'
                    //          'settings.2'
                    //      ]
                    //
                    expect(pattern.test(Object.keys(master).join('\n'))).to.be.true;
                }
                else {
                    // Exact Key Matching
                    // e.g.
                    //      MASTER
                    //      [
                    //          'uh.logo',
                    //          'uh.profile'
                    //      ]
                    //
                    //      DELTA
                    //      [
                    //          'uh.logo'
                    //      ]
                    //
                    expect(Object.keys(master)).to.include(key);
                }
            });
        });
    });
});
