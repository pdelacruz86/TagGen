/*global require, describe:true, it:true */

'use strict';

var _require = require('root-require');
var expect = require('chai').expect;
var flat = require('flat');
var Immutable = require('immutable');

describe('configs/components', function () {
    var data = _require('configs/components/');
    data = Immutable.fromJS(data);

    var master = data.get('master').get(0);
    master = flat(master.toJS());

    var deltas = data.get('device')
        .concat(data.get('lang'))
        .concat(data.get('site'))
        .concat(data.get('partner'));

    // var skips = [
    // ];

    var regexps = [
        /^settings.*?$/m,
        /^uh.topbar.*?$/m,
        /^uh.logo.magData.*?$/m
    ];

    deltas.forEach(function (delta) {
        it (delta.get('settings'), function () {
            var _delta = flat(delta.toJS());
            Object.keys(_delta).forEach(function(key) {
                // var isSkipped = false;
                var pattern;

                // skips.forEach(function (skip) {
                //     if (skip.test(key)) {
                //         // console.log('[SKIP]', key, _delta[key]);
                //         isSkipped = true;
                //     }
                // });
                //
                // if (isSkipped) {
                //     return;
                // }

                regexps.forEach(function (regexp) {
                    if (regexp.test(key)) {
                        // console.log('[REGEXP]', key, _delta[key]);
                        pattern = new RegExp(regexp);
                        return;
                    }
                });

                // console.log(key, master[key], _delta[key]);
                if (pattern) {
                    // RegExp Key Matching
                    // e.g.
                    //      MASTER
                    //      [
                    //          'settings.0'
                    //      ]
                    //
                    //      DELTA
                    //      [
                    //          'settings.0'
                    //          'settings.1'
                    //          'settings.2'
                    //      ]
                    //
                    expect(pattern.test(Object.keys(master).join('\n'))).to.be.true;
                }
                else {
                    // Exact Key Matching
                    // e.g.
                    //      MASTER
                    //      [
                    //          'uh.logo',
                    //          'uh.profile'
                    //      ]
                    //
                    //      DELTA
                    //      [
                    //          'uh.logo'
                    //      ]
                    //
                    expect(Object.keys(master)).to.include(key);
                }
            });
        });
    });
});
