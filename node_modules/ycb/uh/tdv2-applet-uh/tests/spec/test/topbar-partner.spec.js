/* global browser, $, it, describe, before */

var chai = require('chai');
var chaiAsPromised = require('chai-as-promised');
var conditions = require('../lib/conditions');
var expect = chai.expect;
var locators = require('../lib/locators');
var when = require('mocha-bdd-when');

chai.use(chaiAsPromised);

describe('#check partner Topbar', function () {
    before(function () {
        return browser.wait(function () {
            return browser.get('/console?ctrl=Header&m_id=tdv2-applet-uh&config.uh.ui.topbar=1&site=style&partner=att').then(function () {
                return true;
            });
        });
    });

    when(conditions['#base']).describe('#base', function () {
        it('should exist', function () {
            var topbar = $(locators.Topbar);
            browser.waitToBePresent(topbar);
            expect(topbar.isPresent()).to.eventually.be.true;
        });
        it('has custom sidebar color', function () {
                var topbar = $(locators.Topbar);

                browser.waitToBePresent(topbar);
                topbar.getCssValue('background-color').then(function(bgcolor) {
                    expect(bgcolor).to.contain('rgba(6, 122, 180, 1)');
                });
            });
        it('has home drop down link', function() {
            var home = $(locators.TopbarHome);
            browser.waitToBePresent(home);

            var homeDropDown = $(locators.TopbarHomeDropDown);
                expect(homeDropDown.isPresent()).to.eventually.equal(false);
                browser.actions().mouseMove(home).mouseDown(home).mouseUp().perform().then(function(){
                expect(homeDropDown.isPresent()).to.eventually.equal(true);
                expect(homeDropDown.isDisplayed()).to.eventually.equal(true);
            });
        });
    });
        it('has more link', function () {
            var more = $(locators.TopbarMore);
            browser.waitToBePresent(more);

            var moreDropDown = $(locators.TopbarMoreDropDown);
                expect(moreDropDown.isPresent()).to.eventually.equal(false);
                browser.actions().mouseMove(more).mouseDown(more).mouseUp().perform().then(function(){
                expect(moreDropDown.isPresent()).to.eventually.equal(true);
                expect(moreDropDown.isDisplayed()).to.eventually.equal(true);
            });
        });
        it('should close when a body element is clicked', function (done) {
            $('body').click().then(function () {
                // wait for the browser to update
                browser.sleep(50);

                $(locators.TopbarMoreDropDown).isPresent().then(function (isPresent) {
                    expect(isPresent).to.be.false;
                    done();
                });
            });
        });
        it('should not close when a menu element is clicked', function (done) {
            var more = $(locators.TopbarMore);
            browser.actions().mouseMove(more).mouseDown(more).mouseUp().perform().then(function(){ 
                browser.sleep(50);
                var list = $(locators.TopbarMoreDropDownList);
                browser.actions()
                    .mouseMove(list, {x: 1, y: 1})
                    .click()
                    .perform()
                    .then(function () {
                        expect(list.isPresent()).to.eventually.be.true;
                        done();
                    });
            });
        });
    });
