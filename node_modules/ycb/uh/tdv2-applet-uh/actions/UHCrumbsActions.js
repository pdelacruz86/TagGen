/**
 * UHCrumbsActions.js
 */
 'use strict';

var debug = require('debug')('UH:UHCrumbsActions');
var UHCrumbsStore = require('../stores/UHCrumbsStore');

var UHCrumbsActions = {
    initializeUHCrumbs: function(context, payload, done) {
        var crumbStore = context.getStore(UHCrumbsStore);
        var ucsCrumb = crumbStore.getUcsCrumb();
        var mailCountCrumb = crumbStore.getMailCountCrumb();
        if (!ucsCrumb && !mailCountCrumb && !crumbStore.getIsFetching()) {
            context.dispatch('FETCH_UHCRUMBS');
            context.service.read('UHCrumbsService', {}, {}, function (err, data) {
                debug('UHCrumbs data', data);
                if (err || !data) {
                    context.dispatch('FETCH_UHCRUMBS_FAILURE', err);
                    return done(err, null);
                }
                context.dispatch('FETCH_UHCRUMBS_SUCCESS', {
                    ucsCrumb: encodeURIComponent(data.ucsCrumb),
                    mailCountCrumb: encodeURIComponent(data.mailCountCrumb)
                });
                done && done();
            });
        } else {
            done && done();
        }
    }
};
module.exports = UHCrumbsActions;
