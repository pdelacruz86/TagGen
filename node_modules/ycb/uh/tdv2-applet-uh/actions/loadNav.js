'use strict';

var debug = require('debug')('uh:actions:loadNav');
var Immutable = require('immutable');
var lib = require('../lib');
var IS_CLIENT = lib.isClient();

/**
 * Load nav data for a header
 * @param {Object} context request context
 * @param {Object} payload metadata passed in by component
 * @param {Function} done callback function
 */
module.exports = function loadNav(context, payload, done) {
    if (IS_CLIENT) {
        debug('client');
        return done && done(null, null);
    }

    debug('server');

    var params = Immutable.fromJS(context.session.dimensions);
    params = params.set('app', 'yahoo');

    debug('params', params.toJS());

    context.service.read('nav', params.toJS(), {}, function (err, data) {
        if (err) {
            context.dispatch('NAV_FAILURE', err);
            return done && done(err, null);
        }

        context.dispatch('NAV_SUCCESS', data);
        return done && done(null, data);
    });
};
